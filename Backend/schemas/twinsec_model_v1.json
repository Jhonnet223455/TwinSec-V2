{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://twinsec.studio/schemas/model/v1",
  "title": "TwinSec Model Schema V1",
  "description": "Schema for dynamically generated simulation models via LLM",
  "type": "object",
  "required": ["name", "type", "version", "solver", "components", "connections"],
  "properties": {
    "name": {
      "type": "string",
      "description": "Unique identifier for the model",
      "pattern": "^[a-z0-9_]+$",
      "minLength": 3,
      "maxLength": 50
    },
    "type": {
      "type": "string",
      "description": "Type of system being modeled",
      "enum": ["tank", "microgrid_dc", "drone", "hvac", "custom"]
    },
    "version": {
      "type": "string",
      "description": "Schema version",
      "const": "1.0"
    },
    "description": {
      "type": "string",
      "description": "Human-readable description of the model",
      "maxLength": 500
    },
    "solver": {
      "type": "object",
      "description": "Simulation solver configuration",
      "required": ["method", "dt"],
      "properties": {
        "method": {
          "type": "string",
          "description": "Numerical integration method",
          "enum": ["euler", "rk4", "odeint"],
          "default": "euler"
        },
        "dt": {
          "type": "number",
          "description": "Time step in seconds",
          "minimum": 0.001,
          "maximum": 10.0,
          "default": 0.1
        },
        "max_duration": {
          "type": "number",
          "description": "Maximum simulation duration in seconds",
          "minimum": 1,
          "maximum": 3600,
          "default": 300
        }
      }
    },
    "components": {
      "type": "array",
      "description": "List of system components",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["id", "kind", "params"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique component identifier",
            "pattern": "^[A-Za-z0-9_]+$"
          },
          "kind": {
            "type": "string",
            "description": "Type of component (plugin-specific)"
          },
          "params": {
            "type": "object",
            "description": "Component-specific parameters",
            "additionalProperties": true
          },
          "initial_state": {
            "type": "object",
            "description": "Initial state variables",
            "additionalProperties": {
              "type": "number"
            }
          }
        }
      }
    },
    "connections": {
      "type": "array",
      "description": "Signal connections between components",
      "items": {
        "type": "object",
        "required": ["from", "to"],
        "properties": {
          "from": {
            "type": "string",
            "description": "Source signal (component_id.signal_name)",
            "pattern": "^[A-Za-z0-9_]+\\.[A-Za-z0-9_]+$"
          },
          "to": {
            "type": "string",
            "description": "Target signal (component_id.signal_name)",
            "pattern": "^[A-Za-z0-9_]+\\.[A-Za-z0-9_]+$"
          },
          "gain": {
            "type": "number",
            "description": "Optional gain/scaling factor",
            "default": 1.0
          }
        }
      }
    },
    "signals": {
      "type": "object",
      "description": "Signal definitions for monitoring and control",
      "properties": {
        "inputs": {
          "type": "array",
          "description": "External input signals",
          "items": {
            "type": "string"
          }
        },
        "outputs": {
          "type": "array",
          "description": "Signals to be exported/monitored",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "hmi": {
      "type": "object",
      "description": "HMI (Human-Machine Interface) configuration",
      "properties": {
        "widgets": {
          "type": "array",
          "description": "UI widgets for visualization and control",
          "items": {
            "type": "object",
            "required": ["kind", "bind"],
            "properties": {
              "kind": {
                "type": "string",
                "description": "Widget type",
                "enum": ["plot", "gauge", "slider", "switch", "tank_view", "valve_view"]
              },
              "bind": {
                "type": "string",
                "description": "Signal to bind (component_id.signal_name)"
              },
              "label": {
                "type": "string",
                "description": "Display label"
              },
              "unit": {
                "type": "string",
                "description": "Physical unit"
              },
              "min": {
                "type": "number",
                "description": "Minimum value for sliders/gauges"
              },
              "max": {
                "type": "number",
                "description": "Maximum value for sliders/gauges"
              }
            }
          }
        },
        "alarms": {
          "type": "array",
          "description": "Alarm/threshold definitions",
          "items": {
            "type": "object",
            "required": ["signal", "condition", "threshold"],
            "properties": {
              "signal": {
                "type": "string",
                "description": "Signal to monitor"
              },
              "condition": {
                "type": "string",
                "enum": ["gt", "lt", "eq", "ge", "le"],
                "description": "Comparison operator (gt: >, lt: <, etc.)"
              },
              "threshold": {
                "type": "number",
                "description": "Threshold value"
              },
              "severity": {
                "type": "string",
                "enum": ["info", "warning", "critical"],
                "default": "warning"
              },
              "message": {
                "type": "string",
                "description": "Alarm message"
              }
            }
          }
        }
      }
    },
    "attacks": {
      "type": "object",
      "description": "Available attack configurations",
      "properties": {
        "fdi": {
          "type": "array",
          "description": "False Data Injection attacks",
          "items": {
            "type": "object",
            "required": ["target", "mode"],
            "properties": {
              "target": {
                "type": "string",
                "description": "Target signal"
              },
              "mode": {
                "type": "string",
                "enum": ["constant", "bias", "replay", "random"],
                "description": "Attack mode"
              },
              "value": {
                "type": "number",
                "description": "Attack value (for constant/bias)"
              }
            }
          }
        },
        "dos": {
          "type": "array",
          "description": "Denial of Service attacks",
          "items": {
            "type": "object",
            "required": ["target"],
            "properties": {
              "target": {
                "type": "string",
                "description": "Target component or channel"
              },
              "drop_rate": {
                "type": "number",
                "minimum": 0,
                "maximum": 1,
                "description": "Packet drop rate (0-1)"
              }
            }
          }
        }
      }
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata",
      "properties": {
        "author": {
          "type": "string"
        },
        "created_at": {
          "type": "string",
          "format": "date-time"
        },
        "llm_provider": {
          "type": "string"
        },
        "prompt_hash": {
          "type": "string"
        }
      }
    }
  }
}
